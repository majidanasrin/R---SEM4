# Load required libraries
library(tidyverse)
library(forecast)
library(lubridate)

# Read the dataset
url <- "https://raw.githubusercontent.com/datasets/covid-19/master/data/time-series-19-covid-combined.csv"
covid_data <- read.csv(url)

# Filter for India and the given date range
india_data <- covid_data %>%
  filter(Country.Region == "India") %>%
  mutate(Date = as.Date(Date)) %>%
  filter(Date >= as.Date("2020-01-22") & Date <= as.Date("2020-12-15"))

# Group by week (to get weekly totals)
weekly_data <- india_data %>%
  mutate(week = floor_date(Date, "week")) %>%
  group_by(week) %>%
  summarise(Confirmed = max(Confirmed),
            Deaths = max(Deaths))

# --- (a) Univariate Time Series Analysis ---
# Create a univariate time series for total positive cases
ts_cases <- ts(weekly_data$Confirmed, start = c(2020, 4), frequency = 52)

# --- (b) Multivariate Time Series Analysis ---
# Create a multivariate time series object
ts_multi <- ts(weekly_data[, c("Confirmed", "Deaths")], start = c(2020, 4), frequency = 52)

# --- (c) Time Series Forecasting ---
fit <- auto.arima(ts_cases)
forecast_cases <- forecast(fit, h = 5)

# --- Plot all three graphs together ---
par(mfrow = c(3, 1))  # Arrange plots in 3 rows

# (1) Univariate Time Series Plot
plot(ts_cases, main = "Weekly Total Positive COVID-19 Cases in India (2020)",
     ylab = "Total Cases", xlab = "Weeks", col = "blue", lwd = 2)

# (2) Multivariate Time Series Plot
matplot(weekly_data$week, weekly_data[, c("Confirmed", "Deaths")],
        type = "l", col = c("blue", "red"), lwd = 2,
        xlab = "Week", ylab = "Count",
        main = "Total Cases vs Deaths in India (Weekly, 2020)")
legend("topleft", legend = c("Confirmed", "Deaths"), col = c("blue", "red"), lty = 1, lwd = 2)

# (3) Forecast Plot
plot(forecast_cases, main = "ARIMA Forecast: Total Positive COVID-19 Cases (Next 5 Weeks)",
     ylab = "Total Cases", xlab = "Time")

par(mfrow = c(1, 1))  # Reset layout
